components:
  - id: "user.expand.path"
    inputs:
      - id: "path"
        required: true
    operations:
      - command: |
          path="{{ .path }}"
          if [[ "$path" == "~"* ]]; then
            echo "${path/#~/$HOME}"
          else
            echo "$path"
          fi
        cleanup:
          - "path"

  - id: "user.home"
    operations:
      - command: echo $HOME
        output_format: "trim"

  - id: "user.history"
    operations:
      - command: |
          case $SHELL in
            */bash)
              history_data=$(cat ~/.bash_history)
              ;;
            */zsh)
              history_data=$(cat ~/.zsh_history | awk -F ': [ 0-9 ]*:[0-9]*;' '{print $2}')
              ;;
            */fish)
              history_data=$(cat ~/.local/share/fish/fish_history | grep -o '"cmd": *"[ ^" ]*"' | sed 's/"cmd": *"//;s/"$//')
              ;;
            *)
              history_data="Unknown shell, can't determine history file"
              ;;
          esac
          echo "$history_data" | awk '{print $1}'
        raw_command: true
        user_shell: true
        silent: true

  - id: "user.history.usage"
    operations:
      - uses: "user.history"
        id: "user_history"
        silent: true

      - command: echo '{{ .user_history }}' | sort | uniq -c | sort -nr | awk '{print $1" "$2}'
        silent: true
