components:
  - id: "user.home"
    operations:
      - command: echo $HOME
        output_format: "trim"

  - id: "user.expand.path"
    inputs:
      - id: "path"
        required: true
    operations:
      - command: |
          path="{{ .path }}"
          if [[ "$path" == "~"* ]]; then
            echo "${path/#~/$HOME}"
          else
            echo "$path"
          fi
        cleanup:
          - "path"

  - id: "user.shell"
    operations:
      - command: basename "$SHELL"
        output_format: "trim"

  - id: "user.history.command.bash"
    operations:
      - command: |
          echo "cat ~/.bash_history"
        output_format: "trim"

  - id: "user.history.command.zsh"
    operations:
      - command: |
          echo "sed -n 's/^: [ 0-9 ]*:[0-9]*;//p' ~/.zsh_history"
        output_format: "trim"

  - id: "user.history.command.fish"
    operations:
      - command: |
          echo "cat ~/.local/share/fish/fish_history | grep -o '\"cmd\": *\"[ ^\" ]*\"' | sed 's/\"cmd\": *\"//;s/\"$//'"
        output_format: "trim"

  - id: "user.history.command"
    operations:
      - uses: "user.shell"
        id: "shell"
        silent: true

      - uses: "user.history.command.bash"
        id: "command"
        condition: .shell == "bash"
        silent: true

      - uses: "user.history.command.zsh"
        id: "command"
        condition: .shell == "zsh"
        silent: true

      - uses: "user.history.command.fish"
        id: "command"
        condition: .shell == "fish"
        silent: true

      - command: echo "{{ .command }}"
        output_format: "trim"
        cleanup:
          - "shell"
          - "command"

  - id: "user.history.usage"
    operations:
      - uses: "user.history.command"
        id: "command"
        silent: true

      - command: eval "{{ .command }}" | awk '{print $1}' | sort | uniq -c | sort -nr | awk '{print $1" "$2}'
        cleanup:
          - "command"
