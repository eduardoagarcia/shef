recipes:
  - name: "update"
    description: "Update all git repositories within the current directory"
    category: "git"
    operations:
      - name: "Find Subdirectories"
        id: "find_dirs"
        command: find . -maxdepth 1 -type d -not -path "." | sort -f
        silent: true
        transform: "{{ .output | trim | split '\n' }}"

      - name: "Process Directories"
        id: "process_dirs"
        control_flow:
          type: "foreach"
          collection: "{{ .find_dirs }}"
          as: "dir"
        operations:
          - name: "Check If Git Repository"
            id: "check_git_repo"
            command: ls -d "{{ .dir }}/.git" 2>/dev/null || echo ""
            silent: true
            transform: "{{ if .output }}is_git_repo{{ else }}not_git_repo{{ end }}"

          - name: "Echo Repository"
            id: "echo_repo"
            command: echo {{ color "yellow" "Updating" }} {{ color "magenta" .dir }}
            condition: ".check_git_repo == 'is_git_repo'"

          - name: "Update Repository"
            id: "update_repo"
            command: git -C {{ .dir }} pull
            execution_mode: "stream"
            condition: ".check_git_repo == 'is_git_repo'"

          - name: "Skip Repository"
            id: "skip_repo"
            command: echo {{ style "dim" (printf "Skipping %s because it is not a git repository" .dir) }}
            condition: ".check_git_repo != 'is_git_repo'"

      - name: "Display Summary"
        command: echo {{ color "green" "Complete!" }}
